<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>저녁 메뉴 추천</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body data-theme="light">
    <div id="top-right-controls">
        <button id="animal-test-nav-button">동물상 테스트</button>
        <div id="theme-toggle-container">
            <button id="theme-toggle"></button>
        </div>
        <div id="lang-toggle-container">
            <button id="lang-toggle">EN</button>
        </div>
    </div>
    <div id="main-content">
        <div id="home-view">
            <menu-recommender></menu-recommender>

            <section id="contact-section">
                <h2>제휴 문의</h2>
                <form action="https://formspree.io/f/mgolwlwb" method="POST" id="contact-form">
                    <div class="form-group">
                        <label for="email">Your email:</label>
                        <input type="email" name="email" id="email" required placeholder="example@email.com">
                    </div>
                    <div class="form-group">
                        <label for="message">Your message:</label>
                        <textarea name="message" id="message" required placeholder="문의 내용을 입력해주세요."></textarea>
                    </div>
                    <button type="submit" id="form-submit-button">Send</button>
                </form>
            </section>

            <section id="comments-section">
                <div id="disqus_thread"></div>
                <script>
                    /**
                    *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
                    *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */
                    /*
                    var disqus_config = function () {
                    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
                    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
                    };
                    */
                    (function() { // DON'T EDIT BELOW THIS LINE
                    var d = document, s = d.createElement('script');
                    s.src = 'https://makeit-1.disqus.com/embed.js';
                    s.setAttribute('data-timestamp', +new Date());
                    (d.head || d.body).appendChild(s);
                    })();
                </script>
                <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            </section>
        </div>

        <section id="animal-face-test-service" style="display: none;">
            <h2>AI 동물상 테스트</h2>
            <p>얼굴 사진을 업로드하면 AI가 닮은 동물을 찾아드립니다!</p>
            <div id="image-upload-container">
                <input type="file" id="image-upload-input" accept="image/*" style="display: none;">
                <label for="image-upload-input" id="upload-label">사진 업로드하기</label>
                <div id="image-preview-container">
                    <img id="image-preview" src="#" alt="미리보기" style="display: none;">
                </div>
            </div>
            <div id="label-container"></div>
            <button id="back-to-home-button">돌아가기</button>
        </section>
    </div>
    <script src="main.js"></script>

    <!-- AI 모델 로드 (Teachable Machine) -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
    <script type="text/javascript">
        const URL_TM = "https://teachablemachine.withgoogle.com/models/ayvkYNWsw/";
        let model, labelContainer, maxPredictions;

        async function loadModel() {
            const modelURL = URL_TM + "model.json";
            const metadataURL = URL_TM + "metadata.json";
            model = await tmImage.load(modelURL, metadataURL);
            maxPredictions = model.getTotalClasses();
            
            labelContainer = document.getElementById("label-container");
            for (let i = 0; i < maxPredictions; i++) {
                labelContainer.appendChild(document.createElement("div"));
            }
        }

        async function predict() {
            const image = document.getElementById("image-preview");
            const prediction = await model.predict(image);
            for (let i = 0; i < maxPredictions; i++) {
                labelContainer.childNodes[i].innerHTML = `
                    <div class="result-bar-container">
                        <span class="result-label">${prediction[i].className}</span>
                        <div class="result-bar" style="width: ${prediction[i].probability * 100}%"></div>
                        <span class="result-value">${(prediction[i].probability * 100).toFixed(0)}%</span>
                    </div>
                `;
            }
        }

        const input = document.getElementById('image-upload-input');
        input.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (event) => {
                const img = document.getElementById('image-preview');
                img.src = event.target.result;
                img.style.display = 'block';
                
                // Wait for image to load before predicting
                img.onload = () => predict();
            };
            reader.readAsDataURL(file);
        });

        // Load model on page load
        window.addEventListener('DOMContentLoaded', loadModel);
    </script>
</body>
</html>

